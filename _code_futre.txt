<!-- Styles -->

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<!-- <link rel="stylesheet" href="css/select2.min.css"> -->
<!-- <link rel="stylesheet" href="css/select2-bootstrap-5-theme.min.css"> -->

<link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/1.3.0/css/searchPanes.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css" />

<!-- Or for RTL support -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" />

<!-- Scripts -->
<script src="js/jquery-3.6.0.min.js" ></script>
<script src="js/bootstrap.bundle.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- <script src="https://cdn.datatables.net/searchpanes/1.3.0/js/dataTables.searchPanes.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script> -->


<!-- ADD -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.datatables.net/searchpanes/1.3.0/js/dataTables.searchPanes.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>


// function FuccategorizedData(dataArray)
// {
//   var data = dataArray;
//   categorizedData = {};
//   data.forEach(item => 
//   {
//     const year = Object.keys(item)[0];
//     const month = item["Mouth"];
//     const totalAmt = item["TOTALAMT"];

//     if (!categorizedData[year])
//     {
//       categorizedData[year] = [];
//     }

//     categorizedData[year].push({ month, totalAmt });
//   });
//   console.log(categorizedData);
// }

function FuccategorizedData(dataArray)
      {
        // var data = dataArray;
        categorizedData = {};
        dataArray.forEach(item => 
        {
          const year = item["Year"];
          const month = item["Mouth"];
          const totalAmt = item["TOTALAMT"];

          if (!categorizedData[year])
          {
            categorizedData[year] = [];
          }

          categorizedData[year].push({ month, totalAmt });
        });
        console.log(categorizedData);
      }


 function CreateTable() {
    var tableHead = $("#mytable thead");
    tableHead.empty();
    var tableBody = $("#mytable tbody");
    tableBody.empty();
    var headRow = $("<tr></tr>");
    var tablecheck = true;

    if (Object.keys(categorizedData).length === 0) {
      // ไม่มีข้อมูล
      tablecheck = false;
      headRow.append($("<th>ไม่มีข้อมูล</th>"));
    } else {
      headRow.append($("<th>ลำดับที่</th>"));
      headRow.append($("<th>Month</th>"));
      for (var year in categorizedData) {
        headRow.append($("<th>" +'ปี'+ year + "</th>"));
      }
    }

    tableHead.append(headRow);

    if (Object.keys(categorizedData).length === 0)
    {
      // ไม่มีข้อมูล
      var emptyRow = $("<tr></tr>");
      emptyRow.append($("<td>ไม่มีข้อมูล</td>"));
      tableBody.append(emptyRow);
    } else
    {
      var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      months.forEach((month, index) => 
      {
        var bodyRow = $("<tr></tr>");
        bodyRow.append($("<td>" + (index + 1) + "</td>"));
        bodyRow.append($("<td>" + month + "</td>"));
        for (var year in categorizedData)
        {
          var yearData = categorizedData[year];
          var found = false;
          yearData.forEach(data =>
          {
            if (data.month === (index + 1).toString())
            {
              bodyRow.append($("<td class='text-end'>" + formatCurrency(data.totalAmt) + "</td>"));
              found = true;
            }
          });
          if (!found)
          {
            bodyRow.append($("<td></td>"));
          }
        }
        tableBody.append(bodyRow);
      });

      var totalRow = $("<tr></tr>"); // เพิ่มแถวผลรวม
      totalRow.append($("<td>รวม</td>")); // เพิ่มเซลล์รวมสำหรับ 2 คอลัมน์แรก
      totalRow.append($("<td>รวม</td>"));
      for (var year in categorizedData) {
        var yearData = categorizedData[year];
        var yearTotal = yearData.reduce(function(sum, data) {
          var totalAmt = parseFloat(data.totalAmt);
          if (!isNaN(totalAmt)) {
            return sum + totalAmt;
          }
          return sum;
        }, 0);
        totalRow.append($("<td class='text-end'>" + formatCurrency(yearTotal.toFixed(2)) + "</td>")); // เพิ่มเซลล์ผลรวมสำหรับแต่ละปี
      }
      tableBody.append(totalRow);

    }


  }

          // function jumpToPage(pageNumber)
    // {
    // var table = $('#table_datahd').DataTable();
    // table.page(pageNumber - 1).draw('page');
    // }   

    // // เพิ่มข้อมูลใหม่เข้าไปใน dataX
    // var newOption = {
    //   id: 6,
    //   text: '66',
    //   value: '5555'
    // };

    // dataX.push(newOption);

    // // เรียกใช้งาน select_get() อีกครั้งเพื่อให้ Select2 ทำการอัปเดตและแสดงตัวเลือกใหม่ที่เพิ่มเข้าไป
    // select_get();

      ////////////////////////////////////////////

    // var newOption = {
    //   id: 6,
    //   text: 'ตัวเลือกที่ 6',
    //   value: '00000006'
    // };

    // // สร้าง Element ของตัวเลือก (option)
    // var option = new Option(newOption.text, newOption.id, false, false);
    // // กำหนดค่า value และ title ให้กับตัวเลือก
    // option.setAttribute('value', newOption.value);
    // option.setAttribute('title', newOption.text);
    // // เพิ่มตัวเลือกใหม่ลงใน Select element
    // $('#searchInput').append(option);

    // // เรียกใช้งาน .trigger('change') เพื่อให้ Select2 ทำการอัปเดต
    // $('#searchInput').trigger('change');